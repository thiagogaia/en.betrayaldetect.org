<!doctype html>
<html lang="en">
<head>
    
   
</script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Betrayal Detected - Loading</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/index.css" rel="stylesheet">
    <link href="./css/carregando.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="./js/gg.js" defer></script>

    <script>!function(i,n){i._plt=i._plt||(n&&n.timeOrigin?n.timeOrigin+n.now():Date.now())}(window,performance);</script>
    <link rel="preload" href="https://scripts.converteai.net/93a3c67c-ddd4-49a5-b6b0-6689d79d7875/players/684214aa24f6b32516fac7a5/v4/player.js" as="script">
    <link rel="preload" href="https://scripts.converteai.net/lib/js/smartplayer-wc/v4/smartplayer.js" as="script">
    <link rel="preload" href="https://cdn.converteai.net/93a3c67c-ddd4-49a5-b6b0-6689d79d7875/68421495b0c1454c78dfd10e/main.m3u8" as="fetch">
    <link rel="dns-prefetch" href="https://cdn.converteai.net">
    <link rel="dns-prefetch" href="https://scripts.converteai.net">
    <link rel="dns-prefetch" href="https://images.converteai.net">
    <link rel="dns-prefetch" href="https://api.vturb.com.br">
   
</head>
<body>
<div class="container-fluid container-total">
    <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <img src="./img/icone-nome-zap.png" class="img3-icone-menu-p1">
    </div>
    <div class="row justify-content-center text-center mt-4">
        <div class="col-10 col-md-6 col-lg-5 mt-3">
            <h2><b>Processing WhatsApp Access</b></h2>
        </div>
        <div class="col-12"></div>
        <div class="col-10 col-md-6 col-lg-4 mt-2">
            <h6 class="text-color-cinza-escuro">Please wait while we connect to the servers and prepare your access.</h6>
        </div>
        <div class="col-12"></div>
        <div class="col-10 col-md-6 col-lg-4 mt-2">
           
            <vturb-smartplayer id="vid-682a39345ff261d135252601" style="display: block; margin: 0 auto; width: 100%; "></vturb-smartplayer> <script type="text/javascript"> var s=document.createElement("script"); s.src="https://scripts.converteai.net/93a3c67c-ddd4-49a5-b6b0-6689d79d7875/players/682a39345ff261d135252601/v4/player.js", s.async=!0,document.head.appendChild(s); </script>

        </div>


        <div class="col-12"></div>
        <div class="col-12 col-md-7 col-lg-4 mt-3">
            <div class="caixa-carregado shadow d-none">
                 
                <div class="d-flex align-items-center justify-content-center">
                  
                   <img class="icone-user-p3" id="whatsappProfilePicStep3" src="./img/user-carregado.png" style="border-radius: 100px">

                    <div class="text-center ms-2">
                        <h6>WhatsApp Profile</h6>
                        <span style="color:#9c9c9c;" class="recuperadoTel">{{ numero }}</span><br>
                        <div class="d-flex justify-content-center align-items-center destaque-verde">
                            <img class="me-1" width="10" height="10" src="./img/ponto-verde.png">
                            <span>Online a few minutes ago</span>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    <span style="font-size: 14px; color: #9c9c9c">Last connection city</span><br>
                    <span id="cidade-1"></span><br><br>
                    <span style="font-size: 14px; color: #9c9c9c">Device status</span><br>
                    <span>Active</span><br>
                </div>
                <div class="text-center mt-2">
                    <form action="./relatorio_h.html" id="relatorioGet" method="get">
                        
                        <button class="btn-acessar-relatorio py-2"><i class="fa-solid fa-chart-line"></i> View Report</button>
                    </form>
                </div>
            </div>
            <div class="caixa-carregando shadow">
                <div class="d-flex align-items-center justify-content-center">
                    <img class="icone-user-p3" id="whatsappProfilePicStep32" src="./img/user-carregado.png" style="border-radius: 100px">
                    <div class="text-center ms-2">
                        <h6>WhatsApp Profile</h6>
                        <span style="color:#9c9c9c;" class="recuperadoTel">{{ numero }}</span>
                        <div class="d-flex justify-content-center align-items-center destaque-verde">
                            <i class="fa-solid fa-location-dot me-2"></i>
                            <span id="cidade-3"></span>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="barra-container mt-4">
                    <div id="barra-progresso"></div>
                </div>

                <p id="status">Connecting to servers... 0%</p>
                <div class="etapas" id="etapas-log">
                    <span id="etapa1" class="oculto"><i class="fa-solid fa-spinner"></i> Initiating connection with WhatsApp servers...<br></span>
                    <span id="etapa2" class="oculto"><i class="fa-solid fa-magnifying-glass"></i> Locating the nearest server...<br></span>
                    <span id="etapa3" class="oculto destaque-verde"><i class="fa-regular fa-circle-check"></i> Server located! Establishing secure connection...<br></span>
                    <span id="etapa4" class="oculto"><i class="fa-solid fa-phone"></i> Verifying phone number...<br></span>
                    <span id="etapa5" class="oculto destaque-verde"><i class="fa-regular fa-circle-check"></i> Valid phone number<br></span>
                    <span id="etapa6" class="oculto"><i class="fa-solid fa-database"></i> Analyzing database...<br></span>
                    <span id="etapa7" class="oculto"><i class="fa-regular fa-user"></i> Fetching profile information...<br></span>
                    <span id="etapa8" class="oculto"><i class="fa-solid fa-location-dot"></i> Detecting device location...<br></span>
                    <span id="etapa9" class="oculto destaque-amarelo"><i class="fa-solid fa-location-pin-lock"></i> Suspicious location found in <b id="cidade-2"></b><br></span>
                    <span id="etapa10" class="oculto"><i class="fa-solid fa-arrows-turn-to-dots"></i> Preparing private reading channel...<br></span>
                    <span id="etapa11" class="oculto destaque-verde"><i class="fa-regular fa-circle-check"></i> Private channel established!<br></span>
                    <span id="etapa12" class="oculto"><i class="fa-solid fa-arrow-up-from-bracket"></i> Synchronizing messages...<br></span>
                    <span id="etapa13" class="oculto destaque-verde"><i class="fa-regular fa-circle-check"></i> Synchronization complete!<br></span>
                    <span id="etapa14" class="oculto destaque-verde"><i class="fa-regular fa-circle-check"></i> Access successfully granted!<br></span>
                </div>
            </div>
        </div>
    </div>
    
</div>

<script src="./js/bootstrap.bundle.js"></script>
<script>
    let city = 'Unknown';
    let recuperado = localStorage.getItem("telefoneFormatado");
    let sexoStorage = localStorage.getItem("sexo");

    console.log("tel"+recuperado);
    if (recuperado) {
      let alterarNumero = document.getElementsByClassName('recuperadoTel');
      for (let i = 0; i < alterarNumero.length; i++) {
        alterarNumero[i].textContent = recuperado;
      }
    }

    async function fetchLocationData() {
        try {
            const response = await fetch('https://wtfismyip.com/json');
            if (!response.ok) throw new Error('Failed to fetch location data');
            const data = await response.json();
            const locationParts = data.YourFuckingLocation.split(',');
            city = (locationParts[0] || 'SÃ£o Paulo').trim();
            region_code = (locationParts[1] || 'SP').trim();

            const cidade1 = document.getElementById('cidade-1');
            const cidade2 = document.getElementById('cidade-2');
            const cidade3 = document.getElementById('cidade-3');

            cidade1.textContent = city;
            cidade2.textContent = city;
            cidade3.textContent = city;

        } catch (e) {
            const mapIframe = document.getElementById('map-iframe');
            if (mapIframe) {
                mapIframe.src = 'https://www.google.com/maps/embed/v1/place?key=AIzaSyAZnW7kz1R4UiARrZLtiiS7dHE9M2VmJBE&q=Motel+Sao+Paulo+SP';
            }
        }
    }

    let formGet = document.getElementById('relatorioGet');
    formGet.addEventListener('submit', function(event) {
      event.preventDefault();
      if (sexoStorage === 'homem') {
        formGet.action = './relatorio_m.html';
      } else {
        formGet.action = './relatorio_h.html';
      }
      let url = new URL(formGet.action);
      window.location.href = url.toString();
    });

    // LOGICA DA FOTO DO WHATSAPP - COPIADA DO STEP2
    const phoneNumber = localStorage.getItem('telefoneFormatado');
    const whatsappProfilePic = document.getElementById('whatsappProfilePicStep3');
    const whatsappProfilePic2 = document.getElementById('whatsappProfilePicStep32');

    async function fetchWhatsAppProfilePic() {
      console.log('ðŸ“¢ [carregando.html:165]', 'vaiiiixx');
        const storedPicUrl = localStorage.getItem('whatsappProfilePicUrl');
        if (storedPicUrl) {
            console.log('Using stored WhatsApp profile picture URL:', storedPicUrl);
            whatsappProfilePic.src = storedPicUrl;
            whatsappProfilePic2.src = storedPicUrl;
            return;
        }

        if (!phoneNumber) {
            console.log('No phone number found in localStorage for WhatsApp picture.');
            whatsappProfilePic.src = './img/user-carregado.png';
            whatsappProfilePic2.src = './img/user-carregado.png';
            localStorage.setItem('whatsappProfilePicUrl', './img/user-carregado.png');
            return;
        }

        const apiPhoneNumber = phoneNumber.startsWith('+') ? phoneNumber.substring(1) : phoneNumber;
        const apiKey = '35d348dc85mshe8259b9d011978cp126640jsnb80f96ef478e';
        const apiUrl = `https://thigato.auralink.com.br/webhook/03255d22-821e-4441-ad4e-bc93f6fe906d?tel=${apiPhoneNumber}`;
        console.log('Fetching WhatsApp profile picture from API:', apiUrl);

        try {
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'x-rapidapi-key': apiKey,
                    'x-rapidapi-host': 'whatsapp-data.p.rapidapi.com'
                }
            });

            if (response.ok) {
                const responseText = await response.json();
                if (responseText) {
                    console.log('Successfully fetched WhatsApp profile picture URL (as text):', responseText);
                    whatsappProfilePic.src = responseText.link;
                    whatsappProfilePic2.src = responseText.link;
                    localStorage.setItem('whatsappProfilePicUrl', responseText.link);
                } else {
                    console.error('API response OK, but text is not a valid URL. Response Text:', responseText);
                    whatsappProfilePic.src = './img/user-carregado.png';
                    whatsappProfilePic2.src = './img/user-carregado.png';
                    localStorage.setItem('whatsappProfilePicUrl', './img/user-carregado.png');
                }
            } else {
                const errorBody = await response.text();
                console.error('Failed to fetch WhatsApp profile picture (response not OK). Status:', response.status, 'Body:', errorBody);
                whatsappProfilePic.src = './img/user-carregado.png';
                whatsappProfilePic2.src = './img/user-carregado.png';
                localStorage.setItem('whatsappProfilePicUrl', './img/user-carregado.png');
            }
        } catch (error) {
            console.error('Error during fetchWhatsAppProfilePic (catch block):', error);
            whatsappProfilePic.src = './img/user-carregado.png';
            whatsappProfilePic2.src = './img/user-carregado.png';
            localStorage.setItem('whatsappProfilePicUrl', './img/user-carregado.png');
        }
    }

    document.addEventListener("DOMContentLoaded", async function() {
      await fetchWhatsAppProfilePic();
      await fetchLocationData();
    });

    // window.addEventListener('DOMContentLoaded', fetchLocationData);

    setTimeout(() => {
        document.querySelector('.spinner').style.display = 'block';
    }, 1000);

    let progresso = 0;
    const barra = document.getElementById("barra-progresso");
    const status = document.getElementById("status");
    const etapasLog = document.getElementById("etapas-log");

    const etapas = [
        { limite: 0, id: "etapa1" },
        { limite: 7, id: "etapa2" },
        { limite: 14, id: "etapa3" },
        { limite: 21, id: "etapa4" },
        { limite: 28, id: "etapa5" },
        { limite: 35, id: "etapa6" },
        { limite: 42, id: "etapa7" },
        { limite: 49, id: "etapa8" },
        { limite: 56, id: "etapa9" },
        { limite: 63, id: "etapa10" },
        { limite: 70, id: "etapa11" },
        { limite: 77, id: "etapa12" },
        { limite: 84, id: "etapa13" },
        { limite: 93, id: "etapa14" }
    ];

    let proximaMensagem = 0;
    const duracaoTotal =  335000  //335000;
    const intervaloMs = 100;
    const passosTotais = duracaoTotal / intervaloMs;
    const incremento = 100 / passosTotais;

    const intervalo = setInterval(() => {
        if (progresso >= 100) {
            clearInterval(intervalo);
            status.textContent = "Successfully connected!";

            const caixaCarregando = document.querySelector('.caixa-carregando');
            const caixaCarregado = document.querySelector('.caixa-carregado');

            caixaCarregando.classList.add('fade-out');

            setTimeout(() => {
                caixaCarregando.style.display = 'none';
                caixaCarregado.classList.remove('d-none');
                caixaCarregado.classList.add('fade-in');
            }, 500);
            return;
        }

        progresso += incremento;
        if (progresso > 100) progresso = 100;

        barra.style.width = progresso + "%";
        status.textContent = `Connecting to servers... ${Math.floor(progresso)}%`;

        if (
            proximaMensagem < etapas.length &&
            progresso >= etapas[proximaMensagem].limite
        ) {
            const elemento = document.getElementById(etapas[proximaMensagem].id);
            if (elemento && elemento.classList.contains("oculto")) {
                elemento.classList.remove("oculto");
                elemento.classList.add("fade-up");
                etapasLog.scrollTop = etapasLog.scrollHeight;
            }
            proximaMensagem++;
        }
    }, intervaloMs);
</script>

</body>
</html>
